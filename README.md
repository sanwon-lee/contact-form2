# 環境構築の手順

実際にアプリを使用できるようにするための環境構築の手順は以下の通りです。（自分用）

- このリモートリポジトリをローカル環境にクローンします。（`git clone git@github.com:sanwon-lee/contact-form2 new-contact-form`など）
- プロジェクトのルート（`.git`が置かれているディレクトリ）で`cp .env.example .env`を実行し、`.env`を修正します。OSの環境変数による上書きも検討してください。
- `docker compose up -d --build`を実行します。
- `cp src/.env.example src/.env`を実行し、`src/.env`の以下の項目を修正します。

`src/.env`

```properties
<!-- 以下の4つの項目はプロジェクトルートの.envと揃えます -->
DB_HOST=replace_me
DB_DATABASE=replace_me
DB_USERNAME=replace_me
DB_PASSWORD=replace_me

<!-- 値をdatabaseにします -->
SESSION_DRIVER=file
```

- `docker compose exec php bash`を実行しphpコンテナ内部に移動します。（以下、ことわりがない限りphpコンテナ内部でコマンドを実行します。）
- `composer install`を実行します。
- `php artisan session:table`を実行します。（`src/database/migrations/`内部にすでに`xxxx_create_sessions_table`というマイグレーションファイルが存在する場合は不要です。）
- `php artisan migrate`を実行します。
- `php artisan key:generate`を実行します。
- インメモリテストを行いたい場合は`src/phpunit.xml`における以下の行のコメントアウトを外します。

```xml:src/phpunit.xml
<!-- <server name="DB_CONNECTION" value="sqlite"/> -->
<!-- <server name="DB_DATABASE" value=":memory:"/> -->
```

- (インメモリテストを行いたい場合)`php artisan test`を実行します。
- これでブラウザにアクセスしアプリを使用することができます。

# その他

プロジェクトを進めながら意識した点をまとめました。

- モデル内でカラム名やカラムの日本語名を定数として定義しマイグレーションファイルやフォームリクエスト、ブレードファイル等で参照すること（後でカラム名を変更するときに変数の値を変えるだけで済むようにするため。ただし、マイグレーションファイルに関してはカラム名を変更するための新しいマイグレーションファイルを作成するべき。）
- ブレードファイルで繰り返し用いるパーツはコンポーネントとして定義し使いまわすようにすること（ブレードファイルがすっきりするため）
- ブラウザの検索結果に入力内容確認画面や送信完了画面が現れることを防ぐための措置を講ずること（SEOの観点からもうれしい）
- 入力内容確認画面で「送信する」ボタンを複数回クリックすることによる二重送信防止のための措置を講ずること（一度押したボタンを無効化する。入力内容確認画面に到達した時点で一度無効化を解除する。キャッシュなどによってまだ送信していないにもかかわらず無効化されてしまっているという状況が発生しうるため）
- 入力内容確認画面で入力画面に戻るための「修正する」ボタンを実装してみること（セッションを活用すること。「修正する」ボタンにはaタグではなくbuttonタグを用いること。入力画面に戻るためのアクションにはフォームリクエストを使用しないこと。）
- （未実装）ユーザー登録やログイン、ログアウト機能を実装してみること(フォームの名前とメールアドレスは入力を省略できるようにしてみる。当然DBにはちゃんと表示されるように。リレーションを使う？)
- 入力フォームや入力内容確認画面はtableタグを用いず、CSS Grid Layoutを用いること
- emailや電話番号に全角英数が用いられていた場合はバリデーションの前に自動で半角へ変換するようにすること。（emailは大文字・小文字を区別せず、DBには小文字で保存する。また、emailの前後のスペースを取り除くこと）
